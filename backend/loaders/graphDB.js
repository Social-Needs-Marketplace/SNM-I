const {RDFMimeType, QueryContentType} = require('graphdb').http;
const {UpdateQueryPayload} = require('graphdb').query;
const {graphdb, mongodb} = require('../config');
const {sleep} = require('../utils');
const {namespaces} = require('./namespaces');
const {initGraphDB, MongoDBIdGenerator, importRepositorySnapshot} = require("graphdb-utils");
let repository;

async function getRepository() {
  while (!repository) {
    await sleep(100);
  }
  return repository;
}


async function cleanup() {
  const sendQuery = async query => {
    try {
      const payload = new UpdateQueryPayload()
        .setQuery(query)
        .setContentType(QueryContentType.SPARQL_UPDATE)
        .setTimeout(5);

      await (await getRepository()).update(payload);
    } catch (e) {
      console.log('Failed to cleanup.', query, e);
    }
  }
  // Remove all named graph
  await sendQuery("DROP NAMED");
}

async function setupConnector(){
  // service, program, characteristicoccurrence, address, organization, volunteer
  let queries = [
    "/repositories/snmi/statements?update=PREFIX%20%3A%3Chttp%3A%2F%2Fwww.ontotext.com%2Fconnectors%2Flucene%23%3E%20PREFIX%20inst%3A%3Chttp%3A%2F%2Fwww.ontotext.com%2Fconnectors%2Flucene%2Finstance%23%3E%20INSERT%20DATA%20%7B%20%09inst%3Aservice_connector%20%3AcreateConnector%20'''%20%7B%20%20%20%22fields%22%3A%20%5B%20%20%20%20%20%7B%20%20%20%20%20%20%20%22fieldName%22%3A%20%22Name%22%2C%20%20%20%20%20%20%20%22propertyChain%22%3A%20%5B%20%20%20%20%20%20%20%20%20%22http%3A%2F%2Fontology.eil.utoronto.ca%2Ftove%2Forganization%23hasName%22%20%20%20%20%20%20%20%5D%2C%20%20%20%20%20%20%20%22indexed%22%3A%20true%2C%20%20%20%20%20%20%20%22stored%22%3A%20true%2C%20%20%20%20%20%20%20%22analyzed%22%3A%20true%2C%20%20%20%20%20%20%20%22multivalued%22%3A%20true%2C%20%20%20%20%20%20%20%22ignoreInvalidValues%22%3A%20false%2C%20%20%20%20%20%20%20%22facet%22%3A%20true%20%20%20%20%20%7D%2C%20%20%20%20%20%7B%20%20%20%20%20%20%20%22fieldName%22%3A%20%22Eligibility%22%2C%20%20%20%20%20%20%20%22propertyChain%22%3A%20%5B%20%20%20%20%20%20%20%20%20%22http%3A%2F%2Fsnmi%23hasEligibilityCondition%22%20%20%20%20%20%20%20%5D%2C%20%20%20%20%20%20%20%22indexed%22%3A%20true%2C%20%20%20%20%20%20%20%22stored%22%3A%20true%2C%20%20%20%20%20%20%20%22analyzed%22%3A%20true%2C%20%20%20%20%20%20%20%22multivalued%22%3A%20true%2C%20%20%20%20%20%20%20%22ignoreInvalidValues%22%3A%20false%2C%20%20%20%20%20%20%20%22facet%22%3A%20true%20%20%20%20%20%7D%20%20%20%5D%2C%20%20%20%22languages%22%3A%20%5B%5D%2C%20%20%20%22types%22%3A%20%5B%20%20%20%20%20%22http%3A%2F%2Fsnmi%23Service%22%20%20%20%5D%2C%20%20%20%22readonly%22%3A%20false%2C%20%20%20%22detectFields%22%3A%20false%2C%20%20%20%22importGraph%22%3A%20false%2C%20%20%20%22skipInitialIndexing%22%3A%20false%2C%20%20%20%22boostProperties%22%3A%20%5B%5D%2C%20%20%20%22stripMarkup%22%3A%20false%20%7D%20'''%20.%20%7D",
    "/repositories/snmi/statements?update=PREFIX%20%3A%3Chttp%3A%2F%2Fwww.ontotext.com%2Fconnectors%2Flucene%23%3E%20PREFIX%20inst%3A%3Chttp%3A%2F%2Fwww.ontotext.com%2Fconnectors%2Flucene%2Finstance%23%3E%20INSERT%20DATA%20%7B%20%09inst%3Aprogram_connector%20%3AcreateConnector%20'''%20%7B%20%20%20%22fields%22%3A%20%5B%20%20%20%20%20%7B%20%20%20%20%20%20%20%22fieldName%22%3A%20%22Name%22%2C%20%20%20%20%20%20%20%22propertyChain%22%3A%20%5B%20%20%20%20%20%20%20%20%20%22http%3A%2F%2Fontology.eil.utoronto.ca%2Ftove%2Forganization%23hasName%22%20%20%20%20%20%20%20%5D%2C%20%20%20%20%20%20%20%22indexed%22%3A%20true%2C%20%20%20%20%20%20%20%22stored%22%3A%20true%2C%20%20%20%20%20%20%20%22analyzed%22%3A%20true%2C%20%20%20%20%20%20%20%22multivalued%22%3A%20true%2C%20%20%20%20%20%20%20%22ignoreInvalidValues%22%3A%20false%2C%20%20%20%20%20%20%20%22facet%22%3A%20true%20%20%20%20%20%7D%20%20%20%5D%2C%20%20%20%22languages%22%3A%20%5B%5D%2C%20%20%20%22types%22%3A%20%5B%20%20%20%20%20%22http%3A%2F%2Fsnmi%23Program%22%20%20%20%5D%2C%20%20%20%22readonly%22%3A%20false%2C%20%20%20%22detectFields%22%3A%20false%2C%20%20%20%22importGraph%22%3A%20false%2C%20%20%20%22skipInitialIndexing%22%3A%20false%2C%20%20%20%22boostProperties%22%3A%20%5B%5D%2C%20%20%20%22stripMarkup%22%3A%20false%20%7D%20'''%20.%20%7D",
    "/repositories/snmi/statements?update=PREFIX%20%3A%3Chttp%3A%2F%2Fwww.ontotext.com%2Fconnectors%2Flucene%23%3E%20PREFIX%20inst%3A%3Chttp%3A%2F%2Fwww.ontotext.com%2Fconnectors%2Flucene%2Finstance%23%3E%20INSERT%20DATA%20%7B%20%09inst%3Acharacteristicoccurrence_connector%20%3AcreateConnector%20'''%20%7B%20%20%20%22fields%22%3A%20%5B%20%20%20%20%20%7B%20%20%20%20%20%20%20%22fieldName%22%3A%20%22string%22%2C%20%20%20%20%20%20%20%22propertyChain%22%3A%20%5B%20%20%20%20%20%20%20%20%20%22http%3A%2F%2Fsnmi%23hasStringValue%22%20%20%20%20%20%20%20%5D%2C%20%20%20%20%20%20%20%22indexed%22%3A%20true%2C%20%20%20%20%20%20%20%22stored%22%3A%20true%2C%20%20%20%20%20%20%20%22analyzed%22%3A%20true%2C%20%20%20%20%20%20%20%22multivalued%22%3A%20true%2C%20%20%20%20%20%20%20%22ignoreInvalidValues%22%3A%20false%2C%20%20%20%20%20%20%20%22facet%22%3A%20true%20%20%20%20%20%7D%2C%20%20%20%20%20%7B%20%20%20%20%20%20%20%22fieldName%22%3A%20%22object%22%2C%20%20%20%20%20%20%20%22propertyChain%22%3A%20%5B%20%20%20%20%20%20%20%20%20%22http%3A%2F%2Fsnmi%23hasObjectValue%22%20%20%20%20%20%20%20%5D%2C%20%20%20%20%20%20%20%22indexed%22%3A%20true%2C%20%20%20%20%20%20%20%22stored%22%3A%20true%2C%20%20%20%20%20%20%20%22analyzed%22%3A%20true%2C%20%20%20%20%20%20%20%22multivalued%22%3A%20true%2C%20%20%20%20%20%20%20%22ignoreInvalidValues%22%3A%20false%2C%20%20%20%20%20%20%20%22facet%22%3A%20true%20%20%20%20%20%7D%2C%20%20%20%20%20%7B%20%20%20%20%20%20%20%22fieldName%22%3A%20%22date%22%2C%20%20%20%20%20%20%20%22propertyChain%22%3A%20%5B%20%20%20%20%20%20%20%20%20%22http%3A%2F%2Fsnmi%23hasDateValue%22%20%20%20%20%20%20%20%5D%2C%20%20%20%20%20%20%20%22indexed%22%3A%20true%2C%20%20%20%20%20%20%20%22stored%22%3A%20true%2C%20%20%20%20%20%20%20%22analyzed%22%3A%20true%2C%20%20%20%20%20%20%20%22multivalued%22%3A%20true%2C%20%20%20%20%20%20%20%22ignoreInvalidValues%22%3A%20false%2C%20%20%20%20%20%20%20%22facet%22%3A%20true%20%20%20%20%20%7D%2C%20%20%20%20%20%7B%20%20%20%20%20%20%20%22fieldName%22%3A%20%22number%22%2C%20%20%20%20%20%20%20%22propertyChain%22%3A%20%5B%20%20%20%20%20%20%20%20%20%22http%3A%2F%2Fsnmi%23hasNumberValue%22%20%20%20%20%20%20%20%5D%2C%20%20%20%20%20%20%20%22indexed%22%3A%20true%2C%20%20%20%20%20%20%20%22stored%22%3A%20true%2C%20%20%20%20%20%20%20%22analyzed%22%3A%20true%2C%20%20%20%20%20%20%20%22multivalued%22%3A%20true%2C%20%20%20%20%20%20%20%22ignoreInvalidValues%22%3A%20false%2C%20%20%20%20%20%20%20%22facet%22%3A%20true%20%20%20%20%20%7D%2C%20%20%20%20%20%7B%20%20%20%20%20%20%20%22fieldName%22%3A%20%22boolean%22%2C%20%20%20%20%20%20%20%22propertyChain%22%3A%20%5B%20%20%20%20%20%20%20%20%20%22http%3A%2F%2Fsnmi%23hasBooleanValue%22%20%20%20%20%20%20%20%5D%2C%20%20%20%20%20%20%20%22indexed%22%3A%20true%2C%20%20%20%20%20%20%20%22stored%22%3A%20true%2C%20%20%20%20%20%20%20%22analyzed%22%3A%20true%2C%20%20%20%20%20%20%20%22multivalued%22%3A%20true%2C%20%20%20%20%20%20%20%22ignoreInvalidValues%22%3A%20false%2C%20%20%20%20%20%20%20%22facet%22%3A%20true%20%20%20%20%20%7D%2C%20%20%20%20%20%7B%20%20%20%20%20%20%20%22fieldName%22%3A%20%22multipleobject%22%2C%20%20%20%20%20%20%20%22propertyChain%22%3A%20%5B%20%20%20%20%20%20%20%20%20%22http%3A%2F%2Fsnmi%23hasMultipleObjectValue%22%20%20%20%20%20%20%20%5D%2C%20%20%20%20%20%20%20%22indexed%22%3A%20true%2C%20%20%20%20%20%20%20%22stored%22%3A%20true%2C%20%20%20%20%20%20%20%22analyzed%22%3A%20true%2C%20%20%20%20%20%20%20%22multivalued%22%3A%20true%2C%20%20%20%20%20%20%20%22ignoreInvalidValues%22%3A%20false%2C%20%20%20%20%20%20%20%22facet%22%3A%20true%20%20%20%20%20%7D%20%20%20%5D%2C%20%20%20%22languages%22%3A%20%5B%5D%2C%20%20%20%22types%22%3A%20%5B%20%20%20%20%20%22http%3A%2F%2Fsnmi%23CharacteristicOccurrence%22%20%20%20%5D%2C%20%20%20%22readonly%22%3A%20false%2C%20%20%20%22detectFields%22%3A%20false%2C%20%20%20%22importGraph%22%3A%20false%2C%20%20%20%22skipInitialIndexing%22%3A%20false%2C%20%20%20%22boostProperties%22%3A%20%5B%5D%2C%20%20%20%22stripMarkup%22%3A%20false%20%7D%20'''%20.%20%7D",
    "/repositories/snmi/statements?update=PREFIX%20%3A%3Chttp%3A%2F%2Fwww.ontotext.com%2Fconnectors%2Flucene%23%3E%20PREFIX%20inst%3A%3Chttp%3A%2F%2Fwww.ontotext.com%2Fconnectors%2Flucene%2Finstance%23%3E%20INSERT%20DATA%20%7B%20%09inst%3Aaddress_connector%20%3AcreateConnector%20'''%20%7B%20%20%20%22fields%22%3A%20%5B%20%20%20%20%20%7B%20%20%20%20%20%20%20%22fieldName%22%3A%20%22city%22%2C%20%20%20%20%20%20%20%22propertyChain%22%3A%20%5B%20%20%20%20%20%20%20%20%20%22http%3A%2F%2Fontology.eil.utoronto.ca%2Ftove%2Ficontact%23hasCityS%22%20%20%20%20%20%20%20%5D%2C%20%20%20%20%20%20%20%22indexed%22%3A%20true%2C%20%20%20%20%20%20%20%22stored%22%3A%20true%2C%20%20%20%20%20%20%20%22analyzed%22%3A%20true%2C%20%20%20%20%20%20%20%22multivalued%22%3A%20true%2C%20%20%20%20%20%20%20%22ignoreInvalidValues%22%3A%20false%2C%20%20%20%20%20%20%20%22facet%22%3A%20true%20%20%20%20%20%7D%2C%20%20%20%20%20%7B%20%20%20%20%20%20%20%22fieldName%22%3A%20%22citysection%22%2C%20%20%20%20%20%20%20%22propertyChain%22%3A%20%5B%20%20%20%20%20%20%20%20%20%22http%3A%2F%2Fontology.eil.utoronto.ca%2Ftove%2Ficontact%23hasCitySection%22%20%20%20%20%20%20%20%5D%2C%20%20%20%20%20%20%20%22indexed%22%3A%20true%2C%20%20%20%20%20%20%20%22stored%22%3A%20true%2C%20%20%20%20%20%20%20%22analyzed%22%3A%20true%2C%20%20%20%20%20%20%20%22multivalued%22%3A%20true%2C%20%20%20%20%20%20%20%22ignoreInvalidValues%22%3A%20false%2C%20%20%20%20%20%20%20%22facet%22%3A%20true%20%20%20%20%20%7D%2C%20%20%20%20%20%7B%20%20%20%20%20%20%20%22fieldName%22%3A%20%22postalcode%22%2C%20%20%20%20%20%20%20%22propertyChain%22%3A%20%5B%20%20%20%20%20%20%20%20%20%22http%3A%2F%2Fontology.eil.utoronto.ca%2Ftove%2Ficontact%23hasPostalCode%22%20%20%20%20%20%20%20%5D%2C%20%20%20%20%20%20%20%22indexed%22%3A%20true%2C%20%20%20%20%20%20%20%22stored%22%3A%20true%2C%20%20%20%20%20%20%20%22analyzed%22%3A%20true%2C%20%20%20%20%20%20%20%22multivalued%22%3A%20true%2C%20%20%20%20%20%20%20%22ignoreInvalidValues%22%3A%20false%2C%20%20%20%20%20%20%20%22facet%22%3A%20true%20%20%20%20%20%7D%2C%20%20%20%20%20%7B%20%20%20%20%20%20%20%22fieldName%22%3A%20%22state%22%2C%20%20%20%20%20%20%20%22propertyChain%22%3A%20%5B%20%20%20%20%20%20%20%20%20%22http%3A%2F%2Fontology.eil.utoronto.ca%2Ftove%2Ficontact%23hasState%22%20%20%20%20%20%20%20%5D%2C%20%20%20%20%20%20%20%22indexed%22%3A%20true%2C%20%20%20%20%20%20%20%22stored%22%3A%20true%2C%20%20%20%20%20%20%20%22analyzed%22%3A%20true%2C%20%20%20%20%20%20%20%22multivalued%22%3A%20true%2C%20%20%20%20%20%20%20%22ignoreInvalidValues%22%3A%20false%2C%20%20%20%20%20%20%20%22facet%22%3A%20true%20%20%20%20%20%7D%2C%20%20%20%20%20%7B%20%20%20%20%20%20%20%22fieldName%22%3A%20%22street%22%2C%20%20%20%20%20%20%20%22propertyChain%22%3A%20%5B%20%20%20%20%20%20%20%20%20%22http%3A%2F%2Fontology.eil.utoronto.ca%2Ftove%2Ficontact%23hasStreet%22%20%20%20%20%20%20%20%5D%2C%20%20%20%20%20%20%20%22indexed%22%3A%20true%2C%20%20%20%20%20%20%20%22stored%22%3A%20true%2C%20%20%20%20%20%20%20%22analyzed%22%3A%20true%2C%20%20%20%20%20%20%20%22multivalued%22%3A%20true%2C%20%20%20%20%20%20%20%22ignoreInvalidValues%22%3A%20false%2C%20%20%20%20%20%20%20%22facet%22%3A%20true%20%20%20%20%20%7D%2C%20%20%20%20%20%7B%20%20%20%20%20%20%20%22fieldName%22%3A%20%22streetdirection%22%2C%20%20%20%20%20%20%20%22propertyChain%22%3A%20%5B%20%20%20%20%20%20%20%20%20%22http%3A%2F%2Fontology.eil.utoronto.ca%2Ftove%2Ficontact%23hasStreetDirection%22%20%20%20%20%20%20%20%5D%2C%20%20%20%20%20%20%20%22indexed%22%3A%20true%2C%20%20%20%20%20%20%20%22stored%22%3A%20true%2C%20%20%20%20%20%20%20%22analyzed%22%3A%20true%2C%20%20%20%20%20%20%20%22multivalued%22%3A%20true%2C%20%20%20%20%20%20%20%22ignoreInvalidValues%22%3A%20false%2C%20%20%20%20%20%20%20%22facet%22%3A%20true%20%20%20%20%20%7D%2C%20%20%20%20%20%7B%20%20%20%20%20%20%20%22fieldName%22%3A%20%22streetnumber%22%2C%20%20%20%20%20%20%20%22propertyChain%22%3A%20%5B%20%20%20%20%20%20%20%20%20%22http%3A%2F%2Fontology.eil.utoronto.ca%2Ftove%2Ficontact%23hasStreetNumber%22%20%20%20%20%20%20%20%5D%2C%20%20%20%20%20%20%20%22indexed%22%3A%20true%2C%20%20%20%20%20%20%20%22stored%22%3A%20true%2C%20%20%20%20%20%20%20%22analyzed%22%3A%20true%2C%20%20%20%20%20%20%20%22multivalued%22%3A%20true%2C%20%20%20%20%20%20%20%22ignoreInvalidValues%22%3A%20false%2C%20%20%20%20%20%20%20%22facet%22%3A%20true%20%20%20%20%20%7D%2C%20%20%20%20%20%7B%20%20%20%20%20%20%20%22fieldName%22%3A%20%22streettype%22%2C%20%20%20%20%20%20%20%22propertyChain%22%3A%20%5B%20%20%20%20%20%20%20%20%20%22http%3A%2F%2Fontology.eil.utoronto.ca%2Ftove%2Ficontact%23hasStreetType%22%20%20%20%20%20%20%20%5D%2C%20%20%20%20%20%20%20%22indexed%22%3A%20true%2C%20%20%20%20%20%20%20%22stored%22%3A%20true%2C%20%20%20%20%20%20%20%22analyzed%22%3A%20true%2C%20%20%20%20%20%20%20%22multivalued%22%3A%20true%2C%20%20%20%20%20%20%20%22ignoreInvalidValues%22%3A%20false%2C%20%20%20%20%20%20%20%22facet%22%3A%20true%20%20%20%20%20%7D%2C%20%20%20%20%20%7B%20%20%20%20%20%20%20%22fieldName%22%3A%20%22unitnumber%22%2C%20%20%20%20%20%20%20%22propertyChain%22%3A%20%5B%20%20%20%20%20%20%20%20%20%22http%3A%2F%2Fontology.eil.utoronto.ca%2Ftove%2Ficontact%23hasUnitNumber%22%20%20%20%20%20%20%20%5D%2C%20%20%20%20%20%20%20%22indexed%22%3A%20true%2C%20%20%20%20%20%20%20%22stored%22%3A%20true%2C%20%20%20%20%20%20%20%22analyzed%22%3A%20true%2C%20%20%20%20%20%20%20%22multivalued%22%3A%20true%2C%20%20%20%20%20%20%20%22ignoreInvalidValues%22%3A%20false%2C%20%20%20%20%20%20%20%22facet%22%3A%20true%20%20%20%20%20%7D%2C%20%20%20%20%20%7B%20%20%20%20%20%20%20%22fieldName%22%3A%20%22type%22%2C%20%20%20%20%20%20%20%22propertyChain%22%3A%20%5B%20%20%20%20%20%20%20%20%20%22http%3A%2F%2Fwww.w3.org%2F1999%2F02%2F22-rdf-syntax-ns%23type%22%20%20%20%20%20%20%20%5D%2C%20%20%20%20%20%20%20%22indexed%22%3A%20true%2C%20%20%20%20%20%20%20%22stored%22%3A%20true%2C%20%20%20%20%20%20%20%22analyzed%22%3A%20true%2C%20%20%20%20%20%20%20%22multivalued%22%3A%20true%2C%20%20%20%20%20%20%20%22ignoreInvalidValues%22%3A%20false%2C%20%20%20%20%20%20%20%22facet%22%3A%20true%20%20%20%20%20%7D%20%20%20%5D%2C%20%20%20%22languages%22%3A%20%5B%5D%2C%20%20%20%22types%22%3A%20%5B%20%20%20%20%20%22http%3A%2F%2Fontology.eil.utoronto.ca%2Ftove%2Ficontact%23Address%22%20%20%20%5D%2C%20%20%20%22readonly%22%3A%20false%2C%20%20%20%22detectFields%22%3A%20false%2C%20%20%20%22importGraph%22%3A%20false%2C%20%20%20%22skipInitialIndexing%22%3A%20false%2C%20%20%20%22boostProperties%22%3A%20%5B%5D%2C%20%20%20%22stripMarkup%22%3A%20false%20%7D%20'''%20.%20%7D",
    "/repositories/snmi/statements?update=PREFIX%20%3A%3Chttp%3A%2F%2Fwww.ontotext.com%2Fconnectors%2Flucene%23%3E%20PREFIX%20inst%3A%3Chttp%3A%2F%2Fwww.ontotext.com%2Fconnectors%2Flucene%2Finstance%23%3E%20INSERT%20DATA%20%7B%20%09inst%3Aorganization_connector%20%3AcreateConnector%20'''%20%7B%20%20%20%22fields%22%3A%20%5B%20%20%20%20%20%7B%20%20%20%20%20%20%20%22fieldName%22%3A%20%22name%22%2C%20%20%20%20%20%20%20%22propertyChain%22%3A%20%5B%20%20%20%20%20%20%20%20%20%22http%3A%2F%2Fontology.eil.utoronto.ca%2Ftove%2Forganization%23hasName%22%20%20%20%20%20%20%20%5D%2C%20%20%20%20%20%20%20%22indexed%22%3A%20true%2C%20%20%20%20%20%20%20%22stored%22%3A%20true%2C%20%20%20%20%20%20%20%22analyzed%22%3A%20true%2C%20%20%20%20%20%20%20%22multivalued%22%3A%20true%2C%20%20%20%20%20%20%20%22ignoreInvalidValues%22%3A%20false%2C%20%20%20%20%20%20%20%22facet%22%3A%20true%20%20%20%20%20%7D%20%20%20%5D%2C%20%20%20%22languages%22%3A%20%5B%5D%2C%20%20%20%22types%22%3A%20%5B%20%20%20%20%20%22http%3A%2F%2Fsnmi%23Organization%22%20%20%20%5D%2C%20%20%20%22readonly%22%3A%20false%2C%20%20%20%22detectFields%22%3A%20false%2C%20%20%20%22importGraph%22%3A%20false%2C%20%20%20%22skipInitialIndexing%22%3A%20false%2C%20%20%20%22boostProperties%22%3A%20%5B%5D%2C%20%20%20%22stripMarkup%22%3A%20false%20%7D%20'''%20.%20%7D",
    "/repositories/snmi/statements?update=PREFIX%20%3A%3Chttp%3A%2F%2Fwww.ontotext.com%2Fconnectors%2Flucene%23%3E%20PREFIX%20inst%3A%3Chttp%3A%2F%2Fwww.ontotext.com%2Fconnectors%2Flucene%2Finstance%23%3E%20INSERT%20DATA%20%7B%20%09inst%3Avolunteer_connector%20%3AcreateConnector%20'''%20%7B%20%20%20%22fields%22%3A%20%5B%20%20%20%20%20%7B%20%20%20%20%20%20%20%22fieldName%22%3A%20%22firstname%22%2C%20%20%20%20%20%20%20%22propertyChain%22%3A%20%5B%20%20%20%20%20%20%20%20%20%22http%3A%2F%2Fxmlns.com%2Ffoaf%2F0.1%2FgivenName%22%20%20%20%20%20%20%20%5D%2C%20%20%20%20%20%20%20%22indexed%22%3A%20true%2C%20%20%20%20%20%20%20%22stored%22%3A%20true%2C%20%20%20%20%20%20%20%22analyzed%22%3A%20true%2C%20%20%20%20%20%20%20%22multivalued%22%3A%20true%2C%20%20%20%20%20%20%20%22ignoreInvalidValues%22%3A%20false%2C%20%20%20%20%20%20%20%22facet%22%3A%20true%20%20%20%20%20%7D%2C%20%20%20%20%20%7B%20%20%20%20%20%20%20%22fieldName%22%3A%20%22lastname%22%2C%20%20%20%20%20%20%20%22propertyChain%22%3A%20%5B%20%20%20%20%20%20%20%20%20%22http%3A%2F%2Fxmlns.com%2Ffoaf%2F0.1%2FfamilyName%22%20%20%20%20%20%20%20%5D%2C%20%20%20%20%20%20%20%22indexed%22%3A%20true%2C%20%20%20%20%20%20%20%22stored%22%3A%20true%2C%20%20%20%20%20%20%20%22analyzed%22%3A%20true%2C%20%20%20%20%20%20%20%22multivalued%22%3A%20true%2C%20%20%20%20%20%20%20%22ignoreInvalidValues%22%3A%20false%2C%20%20%20%20%20%20%20%22facet%22%3A%20true%20%20%20%20%20%7D%20%20%20%5D%2C%20%20%20%22languages%22%3A%20%5B%5D%2C%20%20%20%22types%22%3A%20%5B%20%20%20%20%20%22http%3A%2F%2Fsnmi%23Volunteer%22%20%20%20%5D%2C%20%20%20%22readonly%22%3A%20false%2C%20%20%20%22detectFields%22%3A%20false%2C%20%20%20%22importGraph%22%3A%20false%2C%20%20%20%22skipInitialIndexing%22%3A%20false%2C%20%20%20%22boostProperties%22%3A%20%5B%5D%2C%20%20%20%22stripMarkup%22%3A%20false%20%7D%20'''%20.%20%7D"
  ]

  for (let i = 0; i < queries.length; i++) {
    await fetch(graphdb.addr + queries[i], {
      method: 'POST',
      headers: {
        ContentType: 'application/json'
      }
    });
  }
  console.log("All connectors are loaded")
}



async function load() {
  // ID Generator for creating new instances
  const idGenerator = new MongoDBIdGenerator(mongodb.addr);

  const result = await initGraphDB({
    idGenerator,
    // GraphDB Server Address
    address: graphdb.addr,
    // Remove the username and password fields if the GraphDB server does not require authentication
    username: graphdb.username,
    password: graphdb.password,
    namespaces,
    // The repository name, a new repository will be created if it does not exist.
    repositoryName: process.env.test ? "snmiTest" : "snmi",
  });

  repository = result.repository;

  await cleanup();
  await importRepositorySnapshot('https://github.com/csse-uoft/compass-ontology/releases/download/latest/compass-ontology+dependencies.brf');

  // Load all the connectors for lucene
  await setupConnector()
}


module.exports = {getRepository, load};
